<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USRP_Server: server_docs/00_intro.md Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../jpl-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">USRP_Server
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">A flexible, GPU-accelerated radio-frequency readout software.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d40/00__intro_8md.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">server_docs/00_intro.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/d40/00__intro_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Overview</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;========</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;An overview of the working principle is reported in the figure below with some system requirements.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;div class=&quot;right_float&quot;&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;\image html general_plot.png &quot;General scheme:&quot;Block representation of the readout system. This software runs on the &quot;Readout server&quot; in the figure.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The goal of this project is to provide a tool to read frequency multiplexed that is flexible enough to service a variety of technologies and, at the same time, easy enouh to develop so that innovative algorithms can be tested without having to deal with an FPGA firmware. Most of the computational operation required by the readout operations are offloaded on the GPU: the firmware present on the USRP device is the stock firmware without any modification. This firmware is used only to communicate data and metadata with the USRP device and does not perform (almost) any operation. Once the data are streamed on the host the server upload them on the GPU memory where they will be analysed. Thanks to the massive parallelization of operation on the GPU device the analysis operations are completed before the next packet of data is uploaded on the GPU. The flexibility of this system relies in the range of operation that can be performed on the data using a Nvidia GPU: thanks to the CUDA language a new signal processing operation can be implemented and tested in a timescale much shorter that the FPGA firmware equivalent. Instructions on how to implement a new algorrithm on the server are contained in the apposite section. Once the data have been analyzed on the GPU they are streamed to a client application via a TCP socket. The client provvided within the system consists of a python library that saves to disk the results and/or plot the data in real time.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Workflow</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;--------</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Once the server is launced, it stastes looking for USRP devices connected to the system. Once at least one device has been found the server starts accepting connections. Two different TCP connection on two different ports (defined at compile time in USRP_server_settings.cpp in variables #TCP_SYNC_PORT and #TCP_ASYNC_PORT) and same socket are accepted and necessary for the system to work. One is a connection used for exchanging messages between server and client, the other is a connection dedicated to data exchange between server and client. Once the connections have been established the server expect a JSON string describing a command: the command describes settings for the USRP hardware and settings for the signal processing/generation needed. Once the JSON command string has been received and validated (settings have to be reasonable) the hardware configuration is applied using the Ettus UHD C++ api to set the USRP FPGA registers and the GPU kernels and meory are initialized accordigly to the requirements in the JSON command. Many threads are spawned in this phase: two different threads for the transmission handling and a minimum of three threads for the receiver side.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The measurement can terminate for different reasons: number of samples in input/output requested has been reached, the client has disconnected or the USRP devices encountered an error.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;When the mesuremnt terminates, all the GPU memory is released, all the queues between threads are clean and every thread (except for memoyr managers and main) is joined; the servers goes in IDLE state waiting for a new command.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Datapath</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;--------</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;Data are moved around the server using the lock-free queue implementation of boost libraries. Those queues (defined in USRP_server_settings.cpp) are queues of pointers to different kind of struct, these structs serve different purposes but relies on the same structure: a pointer to the memory and some metadata usefull to read the memory.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;&lt;div class=&quot;right_float&quot;&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;\image html Memory_model.png &quot;RX datapath scheme:&quot;Block representation of the datapath in the receiver side.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;&lt;div class=&quot;left_float&quot;&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;\image html memory_tx.png &quot;TX datapath scheme:&quot;Block representation of the datapath in the transmission side.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;Memory</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;----------------</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;&lt;div class=&quot;left_float&quot;&gt;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;\image html Memory_allocator.png Block diagram of the memory manager class used in the server.</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;&lt;/div&gt;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d1/d40/00__intro_8md.html">00_intro.md</a></li>
    <li class="footer">Generated on Mon Jan 28 2019 10:08:42 for USRP_Server by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
